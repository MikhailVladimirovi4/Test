using System;
using System.Collections.Generic;

namespace TestOOP
{
    class Program
    {
        static void Main(string[] args)
        {
            Station station = new Station();

            station.Work();
        }
    }
    class Station
    {
        private readonly Dictionary<Ticket, Train> _routes = new Dictionary<Ticket, Train>();

        public void Work()
        {
            bool isWork = true;

            while (isWork)
            {
                Console.Clear();
                DrawFormations();
                DrawInterface();
                Console.Write(" Введите действие: ");
                string action = Console.ReadLine();

                switch (action)
                {
                    case "1":
                        CreateRoute();
                        break;

                    case "2":
                        SendFormations();
                        break;

                    case "3":
                        isWork = false;
                        break;

                    default:
                        Console.WriteLine("Хрень");
                        break;
                }
            }
        }

        private void DrawInterface()
        {
            int interfacePositionX = 0;
            int interfacePositionY = 10;

            Console.SetCursorPosition(interfacePositionX, interfacePositionY);
            Console.WriteLine(" Формирование, отправление поездов:\n\n 1 - Сформировать направление.\n");

            if (_routes.Count > 0)
                Console.WriteLine(" 2 - Отправить состав(ы).\n");

            Console.WriteLine(" 3 - Закончить работу станции.\n");
        }

        private void CreateRoute()
        {
            Console.Write("\n Пример описания направления: Мухостранск - Ракова Горка.\n Введите описание: ");
            string directionDescription = Console.ReadLine();
            Ticket destinationPassengers = new Ticket(directionDescription);
            Train train = new Train(destinationPassengers.NumberPassengers);
            _routes.Add(destinationPassengers, train);
        }

        private void SendFormations()
        {
            _routes.Clear();
        }

        private void DrawFormations()
        {
            int formationPositionX = 2;
            int formationPositionY = 1;

            ConsoleColor defaultColor = Console.ForegroundColor;
            Console.ForegroundColor = ConsoleColor.Green;

            foreach (var meaning in _routes)
            {
                Console.SetCursorPosition(formationPositionX, ++formationPositionY);
                Console.Write($"Направление: {meaning.Key.Description} - пассажиров: {meaning.Key.NumberPassengers}. ");
                Console.Write($" В составе вагоны рассчитаны на: ");
                meaning.Value.DrawWagons();
                Console.Write(" мест.");
            }

            Console.ForegroundColor = defaultColor;
        }
    }

    class Route
    {
        public string Description { get; private set; }

        public Route(string description)
        {
            Description = description;
        }
    }

    class Ticket : Route
    {
        private readonly Random _random = new Random();
        private readonly int _minimumNumberSeats = 50;
        private readonly int _maximumNumberSeats = 100;
        public int NumberPassengers { get; private set; }

        public Ticket(string description) : base(description)
        {
            NumberPassengers = _random.Next(_minimumNumberSeats, _maximumNumberSeats);
        }
    }

    class Train
    {
        private readonly int _numberSeats = 0;
        private readonly List<Wagon> _wagons = new List<Wagon>();

        public Train(int numberPassengers)
        {
            while (numberPassengers > _numberSeats)
            {
                Wagon wagon = new Wagon();
                _wagons.Add(wagon);
                _numberSeats += wagon.Seats;
            }
        }

        public void DrawWagons()
        {
            foreach (Wagon wagon in _wagons)
            {
                Console.Write(" " + wagon.Seats);
            }
        }
    }

    class Wagon
    {
        private readonly static Random _random = new Random();
        private readonly  int _seatType1 = 15;
        private readonly  int _seatType2 = 25;
        private readonly  int _seatType3 = 35;
        public int Seats { get; private set; }

        public Wagon()
        {
            int[] _placeWagon = { _seatType1, _seatType2, _seatType3 };
            Seats = _placeWagon[_random.Next(0, _placeWagon.Length)];
        }
    }
}
