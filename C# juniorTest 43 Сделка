using System;
using System.Collections.Generic;

namespace TestOOP
{
    class Program
    {
        static void Main(string[] args)
        {
            Shop shop = new Shop();

            shop.Work();
        }
    }

    class Shop
    {
        public void Work()
        {
            bool isPlay = true;
            int coinsSalesman = 500;
            int coinsPlayer = 1000;
            Salesman salesman = new Salesman(coinsSalesman, new List<Item>());
            Player player = new Player(coinsPlayer, new List<Item>());

            salesman.CreateItems();

            while (isPlay)
            {
                Console.Clear();
                DrawItems(salesman, player);
                DrawInterface();
                Console.Write("Ваши действия: ");
                string select = Console.ReadLine();

                switch (select)
                {
                    case "1":
                        MakeDial(salesman, player);
                        break;

                    case "2":
                        isPlay = false;
                        break;

                    default:
                        Console.WriteLine("хрень");
                        break;
                }
            }
        }

        private void DrawInterface()
        {
            Console.SetCursorPosition(0, 0);
            Console.WriteLine("Варианты: \n\n 1 - Купить вещь.\n\n 2 - Уйти.\n");
        }

        private void MakeDial(Salesman salesman, Player buyer)
        {
            Item item;

            Console.Write("Введите название предмета: ");
            string nameItem = Console.ReadLine();

            if (salesman.TryGetItem(nameItem, out item))
            {
                if (item.Price <= buyer.Coins)
                {
                    buyer.BuyingItem(item);
                    salesman.SellItems(item);
                }
                else
                {
                    Console.WriteLine("Ха, полковник Кудасов - НИЩИЙ :)");
                    Console.ReadKey();
                }
            }
        }

        private void DrawItems(Salesman salesman, Player player)
        {
            int positionSellerItemListX = 40;
            int positionBuyerItemListX = 80;
            int positionItemListY = 2;

            salesman.DrawItems(positionSellerItemListX, positionItemListY, "Предметы продавца");
            player.DrawItems(positionBuyerItemListX, positionItemListY, "Предметы игрока");
        }
    }

    class GameMembers
    {
        private readonly List<Item> _inventory;
        public int Coins { get; private set; }

        protected GameMembers(int coins, List<Item> lists)
        {
            Coins = coins;
            _inventory = lists;
        }

        public void DrawItems(int positionX, int positionY, string text)
        {
            Console.SetCursorPosition(positionX, positionY - 1);
            Console.Write(text + ". " + Coins + " монет.");

            for (int i = 0; i < _inventory.Count; i++)
            {
                Console.SetCursorPosition(positionX, positionY++);
                _inventory[i].Draw();
            }
        }

        public bool TryGetItem(string name, out Item item)
        {
            bool isFound = false;
            item = null;

            for (int i = 0; i < _inventory.Count; i++)
            {
                if (_inventory[i].Name == name)
                {
                    isFound = true;
                    item = _inventory[i];
                }
            }
            return isFound;
        }

        protected void AddItem(Item item)
        {
            _inventory.Add(item);
        }

        protected void RemoveItem(Item item)
        {
            _inventory.Remove(item);
        }

        protected void AddCoins(int number)
        {
            Coins += number;
        }

        protected void RemoveCoins(int number)
        {
            Coins -= number;
        }

        protected void CreateItem()
        {
            int price;

            Console.WriteLine("Введите название, затем стоимость предмета");
            string name = Console.ReadLine();
            int.TryParse(Console.ReadLine(), out price);
            _inventory.Add(new Item(name, price));
        }
    }

    class Salesman : GameMembers
    {
        private readonly int _amountItems = 5;
        public Salesman(int coins, List<Item> inventory) : base(coins, inventory) { }

        public void CreateItems()
        {
            for (int i = 0; i < _amountItems; i++)
            {
                CreateItem();
            }
        }

        public void SellItems(Item item)
        {
            RemoveItem(item);
            AddCoins(item.Price);
        }
    }

    class Player : GameMembers
    {
        public Player(int coins, List<Item> inventory) : base(coins, inventory) { }

        public void BuyingItem(Item item)
        {
            AddItem(item);
            RemoveCoins(item.Price);
        }
    }

    class Item
    {
        public string Name { get; private set; }
        public int Price { get; private set; }

        public Item(string name, int price)
        {
            Name = name;
            Price = price;
        }

        public void Draw()
        {
            Console.Write(Name + " " + Price + "монет");
        }
    }
}
