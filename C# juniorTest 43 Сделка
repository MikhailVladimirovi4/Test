using System;
using System.Collections.Generic;

namespace TestOOP
{
    class Program
    {
        static void Main(string[] args)
        {
            bool isPlay = true;
            int coinsSalesman = 500;
            int coinsPlayer = 1000;

            Salesman salesman = new Salesman(coinsSalesman, new List<Item>());
            Player player = new Player(coinsPlayer, new List<Item>());
            Score score = new Score();

            salesman.CreateItems();

            while (isPlay)
            {
                Console.Clear();
                salesman.DrawItems(salesman.listsItemPositionX, salesman.listsItemPositionY, "Предметы продавца");
                player.DrawItems(player.listsItemPositionX, player.listsItemPositionY, "Предметы игрока");
                score.DrawInterface();
                Console.Write("Ваши действия: ");
                string select = Console.ReadLine();

                switch (select)
                {
                    case "1":
                        score.MakeDial(salesman, player);
                        break;

                    case "2":
                        isPlay = false;
                        break;

                    default:
                        Console.WriteLine("хрень");
                        break;
                }
            }
        }
    }

    class Score
    {
        public void DrawInterface()
        {
            Console.SetCursorPosition(0, 0);
            Console.WriteLine("Варианты: \n\n 1 - Купить вещь.\n\n 2 - Уйти.\n");
        }

        public void MakeDial(Salesman salesman, Player buyer)
        {
            Item item;

            Console.Write("Введите название предмета: ");
            string nameItem = Console.ReadLine();

            if (salesman.TryGetItem(nameItem, out item))
            {
                if (item.Price <= buyer.GetNumberCoins())
                {
                    buyer.BayItems(item);
                    salesman.SellItems(item);
                }
                else
                {
                    Console.WriteLine("Ха, полковник Кудасов - НИЩИЙ :)");
                    Console.ReadKey();
                }
            }
        }
    }

    class GameMembers
    {
        private int Coins;
        private readonly List<Item> Inventory;

        protected GameMembers(int coins, List<Item> lists)
        {
            Coins = coins;
            Inventory = lists;
        }

        public void DrawItems(int positionX, int positionY, string text)
        {
            Console.SetCursorPosition(positionX, positionY - 1);
            Console.Write(text + ". " + Coins + " монет.");

            for (int i = 0; i < Inventory.Count; i++)
            {
                Console.SetCursorPosition(positionX, positionY++);
                Inventory[i].Draw();
            }
        }

        protected void AddItem(Item item)
        {
            Inventory.Add(item);
        }

        protected void RemoveItem(Item item)
        {
            Inventory.Remove(item);
        }

        public bool TryGetItem(string name, out Item item)
        {
            bool isFound = false;
            item = null;

            for (int i = 0; i < Inventory.Count; i++)
            {
                if (Inventory[i].Name == name)
                {
                    isFound = true;
                    item = Inventory[i];
                }
            }
            return isFound;
        }

        protected void AddCoins(int number)
        {
            Coins += number;
        }

        protected void RemoveCoins(int number)
        {
            Coins -= number;
        }

        protected void CreateItem()
        {
            int price;

            Console.WriteLine("Введите название, затем стоимость предмета");
            string name = Console.ReadLine();
            int.TryParse(Console.ReadLine(), out price);
            Inventory.Add(new Item(name, price));
        }

        protected int GetCoins()
        {
            return Coins;
        }
    }

    class Salesman : GameMembers
    {
        public int listsItemPositionX { get; private set; } = 40;
        public int listsItemPositionY { get; private set; } = 2;

        private readonly int _amountItems = 5;
        public Salesman(int coins, List<Item> inventory) : base(coins, inventory) { }

        public void CreateItems()
        {
            for (int i = 0; i < _amountItems; i++)
            {
                CreateItem();
            }
        }

        public void SellItems(Item item)
        {
            RemoveItem(item);
            AddCoins(item.Price);
        }
    }

    class Player : GameMembers
    {
        public int listsItemPositionX { get; private set; } = 80;
        public int listsItemPositionY { get; private set; } = 2;
        public Player(int coins, List<Item> inventory) : base(coins, inventory) { }

        public void BayItems(Item item)
        {
            AddItem(item);
            RemoveCoins(item.Price);
        }
        public int GetNumberCoins()
        {
            return GetCoins();
        }
    }

    class Item
    {
        public string Name { get; private set; }
        public int Price { get; private set; }

        public Item(string name, int price)
        {
            Name = name;
            Price = price;
        }

        public void Draw()
        {
            Console.Write(Name + " " + Price + "монет");
        }
    }
}
