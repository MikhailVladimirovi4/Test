using System;
using System.Collections.Generic;

namespace TestOOP
{
    class Program
    {
        static void Main(string[] args)
        {
            Shop shop = new Shop();
            string[] clientNames = { "Паша", "Гоша", "Степа", "Саша" };
            int[] walletVolumes = { 200, 300, 400, 500 };

            shop.CreateTrade(clientNames, walletVolumes);
        }
    }

    class Shop
    {
        private readonly static Random _random = new Random();
        private readonly Queue<Client> _clients = new Queue<Client>();
        private readonly string[] _showcase  = { "Лопата", "Самокат", "Жвачка", "Колесо", "Ручка", "Катер", "Ракета", };

        public string[] GetShowcase() { return _showcase; }

        public void CreateTrade(string[] clientNames, int[] walletVolumes)
        {
            int storeBalance = 0;

            CreareQueue(clientNames, walletVolumes);

            while (_clients.Count > 0)
            {
                Console.Clear();
                Client client = _clients.Dequeue();
                ShowInfo(client, storeBalance);
                OptimizeItemCosts(client);
                storeBalance += GetCostItem(client);
                client.TakeCoins(GetCostItem(client));
                ShowInfo(client, storeBalance, "После обслуживания ");
                Console.ReadKey();
            }

            Console.Clear();
            Console.WriteLine("\n\n  Всех обслужили, монет в кассе: " + storeBalance);
            Console.ReadKey();
        }

        private void ShowInfo(Client client, int number, string text  = "Когда пришел на кассу")
        {
            Console.Write(text + " ");
            client.ShowInfo();
            Console.WriteLine("\n Монет в кассе: " + number + "\n");
        }

        private void OptimizeItemCosts(Client client)
        {
            bool isNotOptimized = client.Coins < GetCostItem(client);

            while (isNotOptimized)
            {
                RemoveItem(client);
                isNotOptimized = client.Coins < GetCostItem(client);
            }
        }

        private void RemoveItem(Client client)
        {
            client.GetListsItem().RemoveItemFromBascket(_random.Next(0, client.GetListsItem().GetBascketSize()));
        }

        private int GetCostItem(Client client)
        {
            int sum = 0;

            for (int i = 0; i < client.GetListsItem().GetBascketSize(); i++)
            {
                sum += client.GetListsItem().GetItemFromCart(i).Price;
            }

            return sum;
        }

        private void CreareQueue(string[] clientNames, int[] walletVolumes)
        {
            for (int i = 0; i < clientNames.Length; i++)
            {
                _clients.Enqueue(new Client(clientNames[i], walletVolumes[_random.Next(0, walletVolumes.Length)]));
            }
        }
    }

    class Product : Shop
    {
        private readonly static Random _random = new Random();
        private readonly int _minimumCostProduct = 50;
        private readonly int _maximumCostProduct = 100;
        public string Name { get; private set; }
        public int Price { get; private set; }

        public Product(string name)
        {
            Name = name;
            Price = _random.Next(_minimumCostProduct, _maximumCostProduct);
        }

        public void ShowInfo()
        {
            Console.WriteLine($"{Name} - {Price} монет");
        }
    }

    class FoodBascket 
    {
        private readonly Shop _shop = new Shop();
        private readonly List<Product> _inventory = new List<Product>();

        public FoodBascket()
        {
            for (int i = 0; i < _shop.GetShowcase().Length; i++)
            {
                _inventory.Add(new Product(_shop.GetShowcase()[i]));
            }
        }

        public Product GetItemFromCart(int number) { return _inventory[number]; }

        public int GetBascketSize() { return _inventory.Count; }

        public void RemoveItemFromBascket(int number) { _inventory.RemoveAt(number); }

        public void ShowInfo()
        {
            foreach (Product product in _inventory)
                product.ShowInfo();
        }
    }

    class Client : Shop
    {
        private FoodBascket _listsItem;
        public string Name { get; private set; }
        public int Coins { get; private set; }

        public Client(string name, int coins)
        {
            Name = name;
            Coins = coins;
            _listsItem = new FoodBascket();
        }

        public FoodBascket GetListsItem() { return _listsItem; }

        public void ShowInfo()
        {
            Console.WriteLine($"{Name} c монетами = {Coins}");
            _listsItem.ShowInfo();
        }

        public void TakeCoins(int number)
        {
            Coins -= number;
        }
    }
}
