using System;
using System.Collections.Generic;
using System.Linq;

namespace CarService
{
    class Program
    {
        static void Main(string[] args)
        {
            Headquarters headquarter = new Headquarters();

            Console.SetWindowSize(Console.LargestWindowWidth, Console.LargestWindowHeight);
            headquarter.GetStarted();
        }
    }

    class Headquarters
    {
        private readonly List<Criminal> _criminals = new List<Criminal>();
        private readonly Analyzer _analyzer = new Analyzer();
        private readonly int _memorySizePC = 15;

        public void GetStarted()
        {
            bool isWork = true;

            CreateCriminals();

            while (isWork)
            {
                Console.Clear();
                DrawInterfaces();
                string action = Console.ReadLine();

                switch (action)
                {
                    case "1":
                        DoFiltering();
                        break;

                    case "2":
                        isWork = false;
                        break;

                    case "3":
                        _analyzer.MakeAmnesty(_criminals);
                        break;

                    default:
                        Console.WriteLine("Криворукий.");
                        break;
                }

                Console.ReadKey();
            }
        }

        private void DoFiltering()
        {
            bool isCorrectInput = true;

            Console.WriteLine("\nВведите: ");
            int minimumHeight = GetNumber("минимальный рост: ", ref isCorrectInput);
            int maximumHeight = GetNumber("максимальный рост: ", ref isCorrectInput);
            int minimumWeight = GetNumber("минимальный вес: ", ref isCorrectInput);
            int maximumWeight = GetNumber("максимальный вес: ", ref isCorrectInput);
            GetWord(out string nationality, ref isCorrectInput);

            if (isCorrectInput)
                _analyzer.GetResult(_criminals, minimumHeight, maximumHeight, minimumWeight, maximumWeight, nationality);
            else
                Console.WriteLine("\nВведены некорректные данные.");
        }

        private void GetWord(out string nationality, ref bool isCorrectInput)
        {
            nationality = null;

            StringArrayStorage storage = new StringArrayStorage();
            Console.Write("преступление: ");
            string word = Console.ReadLine();

            foreach (string item in storage.Crimes)
            {
                if (word.ToLower() == item.ToLower())
                {
                    nationality = item + " ";
                    isCorrectInput = true;
                    return;
                }
                else
                {
                    isCorrectInput = false;
                }
            }
        }

        private int GetNumber(string text, ref bool isCorrectInput)
        {
            Console.Write(text);
            if (int.TryParse(Console.ReadLine(), out int number))
                return number;
            else
                isCorrectInput = false;
            return 0;
        }

        private void DrawInterfaces()
        {
            DrawCriminals();
            DrawMenu();
        }

        private void DrawMenu()
        {
            Console.SetCursorPosition(0, 0);
            Console.WriteLine("Рабочий стол детектива:\n\n 1 - Фильт подозреваемых.\n 2 - Закончить работу. \n 3 - Амнистия.");
            Console.Write("\nВыбор действия: ");
        }

        private void DrawCriminals()
        {
            int positionCriminalsX = 55;
            int positionCriminalsY = 2;

            Console.SetCursorPosition(positionCriminalsX, 0);
            Console.WriteLine(" Картотека преступников: ФИО; Рост; Вес; Преступление; Арестован:\n");

            for (int i = 0; i < _criminals.Count; i++)
            {
                Console.SetCursorPosition(positionCriminalsX, positionCriminalsY++);
                _criminals[i].Draw();
            }
        }

        private void CreateCriminals()
        {
            for (int i = 0; i < _memorySizePC; i++)
                _criminals.Add(new Criminal());
        }
    }

    class Analyzer
    {
        public void GetResult(List<Criminal> _criminals, int minimumHeight, int maximumHeight, int minimumWeight, int maximumWeight, string nationality)
        {
            var filterResult = _criminals.Where(criminal => criminal.Height >= minimumHeight && criminal.Height <= maximumHeight && criminal.Weight >= minimumWeight && criminal.Weight <= maximumWeight && criminal.IsInPrison == false && criminal.Crime == nationality).ToList();
            DrawResult(filterResult, "Под критерии подходят:");

        }

        public void MakeAmnesty(List<Criminal> _criminals)
        {
            string amnestyKey = "Антиправительственное ";

            var resultAmnesty = _criminals.Where(criminal => criminal.Crime != amnestyKey).ToList();
            DrawResult(resultAmnesty, "Остались Заключенные");
        }

        private void DrawResult(List <Criminal> result, string text)
        {
            Console.WriteLine($"\n\n{text}\n");

            foreach (var persoon in result)
            {
                Console.WriteLine($"{persoon.FullName} : {persoon.Height} : {persoon.Weight} : {persoon.Crime}");
            }
        }
    }

    class Criminal
    {
        private static readonly Random _random = new Random();
        private readonly StringArrayStorage _lists = new StringArrayStorage();

        public string FullName { get; private set; }
        public int Height { get; private set; }
        public int Weight { get; private set; }
        public string Crime { get; private set; }
        public bool IsInPrison { get; private set; }

        public Criminal()
        {
            int minimumHeight = 150;
            int maximumHeight = 200;
            int minimumWeight = 60;
            int maximumWeight = 120;

            FullName = new StringGenerator(_lists.Surnames, _lists.Names, _lists.Patronymics).Result;
            Height = _random.Next(minimumHeight, maximumHeight);
            Weight = _random.Next(minimumWeight, maximumWeight);
            Crime = new StringGenerator(_lists.Crimes).Result;
            IsInPrison = GetBooleanValue();
        }

        public void Draw()
        {
            Console.Write(FullName);
            AlignText();
            Console.Write($": {Height} : {Weight} : {Crime} : {IsInPrison}");
        }

        private bool GetBooleanValue()
        {
            int topBarRandom = 100;
            int modifierRandom = 1;

            if (_random.Next(0, topBarRandom) % modifierRandom > 0)
                return false;
            else
                return true;
        }

        private void AlignText()
        {
            char sing = ' ';
            int fieldLengthFullName = 30;
            int number = fieldLengthFullName - FullName.Length;

            for (int i = 0; i < number; i++)
                Console.Write(sing);
        }
    }

    class StringGenerator
    {
        private static readonly Random _random = new Random();
        public string Result { get; private set; }

        public StringGenerator(string[] array1, string[] array2 = null, string[] array3 = null)
        {
            Result = Get(array1) + Get(array2) + Get(array3);
        }

        private string Get(string[] array)
        {
            if (array != null)
                return array[_random.Next(0, array.Length)] + " ";
            else
                return null;
        }
    }

    class StringArrayStorage
    {
        public string[] Names { get; private set; } = { "Иван", "Степан", "Баклан", "Колыван", "Диван", "Урал", "Денис", };
        public string[] Patronymics { get; private set; } = { "Иванович", "Степанович", "Бакланович", "Колыванович", "Диванович", "Урал", "Денисович", };
        public string[] Surnames { get; private set; } = { "Иванов", "Степанов", "Бакланов", "Колыванов", "Диванов", "Уралов", "Денисов", };
        public string[] Crimes { get; private set; } = { "Антиправительственное", "Желтый", "Зеленый" };
    }
}
